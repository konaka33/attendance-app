# 出退勤打刻アプリ 仕様書

## 1. 概要
スマートフォンからワンタップで出退勤を打刻し、管理者のLINEグループに自動通知するWebアプリケーション。
PWA（Progressive Web App）対応により、スマホのホーム画面に追加してネイティブアプリのように使用できます。

## 2. 目的
- 研修生の出退勤を簡単に記録
- リアルタイムでLINEグループに通知
- 勤務時間を自動計算
- スプレッドシートで一元管理

## 3. ユーザー情報

### 研修生情報
- **研修生ID**: user01
- **氏名**: konaka33（後で実名に変更可能）
- **ステータス**: 進行中

## 4. 画面構成

### 4.1 メイン画面
```
+----------------------------------+
|     出退勤打刻アプリ             |
|     konaka33 (user01)            |
+----------------------------------+
| 現在時刻: 2025/10/30 09:05      |
+----------------------------------+
|                                  |
|     [  出勤  ]                   |
|                                  |
|     [  退勤  ]                   |
|                                  |
+----------------------------------+
| 本日の記録:                      |
| 出勤: 09:05                      |
| 退勤: --:--                      |
| 勤務時間: 計算中...              |
+----------------------------------+
|                                  |
| [🎉 課題完了報告]                |
|                                  |
+----------------------------------+
```

### 4.2 PWAインストール
- スマホのホーム画面に追加可能
- オフラインでも起動（通信は必要）
- アプリアイコン表示
- スプラッシュスクリーン表示

## 5. 機能一覧

### 5.1 必須機能

#### F1: 出勤打刻機能
- **動作**
  1. 「出勤」ボタンをタップ
  2. 現在時刻を取得
  3. スプレッドシート「打刻記録」に記録
  4. LINEグループに通知
  5. 画面に「出勤完了」メッセージ表示

- **LINE通知フォーマット**
  ```
  【出勤】
  konaka33 (user01)
  2025/10/30 09:05
  ```

#### F2: 退勤打刻機能
- **動作**
  1. 「退勤」ボタンをタップ
  2. 現在時刻を取得
  3. 出勤時刻から勤務時間を自動計算
  4. スプレッドシート「打刻記録」を更新
  5. LINEグループに通知（勤務時間含む）
  6. 画面に「退勤完了」メッセージ表示

- **勤務時間計算**
  - 退勤時刻 - 出勤時刻 = 勤務時間
  - 表示形式: 「X時間Y分」

- **LINE通知フォーマット**
  ```
  【退勤】
  konaka33 (user01)
  出勤：09:05
  退勤：18:10
  勤務：9時間5分
  ```

#### F3: 本日の記録表示機能
- **表示内容**
  - 本日の出勤時刻
  - 本日の退勤時刻（未退勤の場合は「--:--」）
  - 勤務時間（退勤後に表示）

- **動作**
  - ページ読み込み時にスプレッドシートから本日の記録を取得
  - リアルタイム表示

#### F4: 課題完了報告機能
- **動作**
  1. 「🎉 課題完了報告」ボタンをタップ
  2. アプリURL、研修生情報をスプレッドシート「課題完了記録」に記録
  3. LINEグループに通知
  4. 完了メッセージ表示

- **LINE通知フォーマット**
  ```
  【🎉課題完了報告🎉】
  研修生：konaka33（user01）
  完了：2025/10/30 15:30

  アプリURL:
  https://konaka33.github.io/attendance-app

  確認をお願いします！
  ```

#### F5: PWA対応
- **機能**
  - manifest.json による PWA 設定
  - Service Worker によるキャッシュ
  - ホーム画面追加プロンプト
  - アプリアイコン（複数サイズ）
  - スプラッシュスクリーン

## 6. データ構造

### 6.1 スプレッドシート構成

#### シート1: 研修生マスタ
| 列名 | データ型 | 説明 |
|------|---------|------|
| 研修生ID | string | user01 |
| 氏名 | string | konaka33 |
| ステータス | string | 進行中 / 完了 / 休止 |

**初期データ**:
```
研修生ID    | 氏名      | ステータス
user01     | konaka33  | 進行中
```

#### シート2: 打刻記録
| 列名 | データ型 | 説明 |
|------|---------|------|
| 日付 | string | YYYY/MM/DD |
| 研修生ID | string | user01 |
| 氏名 | string | konaka33 |
| 出勤時刻 | string | HH:mm |
| 退勤時刻 | string | HH:mm |
| 勤務時間 | string | X時間Y分 |

**データ例**:
```
日付       | 研修生ID | 氏名      | 出勤時刻 | 退勤時刻 | 勤務時間
2025/10/30 | user01  | konaka33  | 09:05   | 18:10   | 9時間5分
```

#### シート3: 課題完了記録
| 列名 | データ型 | 説明 |
|------|---------|------|
| 完了日時 | string | YYYY/MM/DD HH:mm |
| 研修生ID | string | user01 |
| 氏名 | string | konaka33 |
| アプリURL | string | GitHub Pages URL |
| 判定 | string | 未確認 / 合格 / 再提出 |

**データ例**:
```
完了日時          | 研修生ID | 氏名      | アプリURL                                    | 判定
2025/10/30 15:30 | user01  | konaka33  | https://konaka33.github.io/attendance-app  | 未確認
```

### 6.2 localStorage データ構造

**キー**: `user_info`
```json
{
  "userId": "user01",
  "name": "konaka33"
}
```

**キー**: `today_attendance`
```json
{
  "date": "2025/10/30",
  "clockIn": "09:05",
  "clockOut": "18:10",
  "workingHours": "9時間5分"
}
```

## 7. 使用技術

### 7.1 フロントエンド
- **HTML5**: PWA対応のセマンティックHTML
- **CSS3**: モバイルファーストデザイン、タッチ最適化
- **JavaScript (ES6+)**:
  - Fetch API（GAS連携）
  - localStorage API
  - Date API（時刻計算）
  - Service Worker API（PWA）

### 7.2 PWA関連
- **manifest.json**: アプリメタデータ
- **Service Worker (sw.js)**: キャッシュ管理
- **アイコン**: 192x192, 512x512 PNG

### 7.3 バックエンド
- **Google Apps Script (GAS)**:
  - SpreadsheetApp API
  - UrlFetchApp API（LINE連携）
  - doPost関数でWebアプリ化

### 7.4 外部API
- **LINE Messaging API**:
  - チャネルアクセストークン: YOZ7Uft...（提供済み）
  - グループID: C5a5b36e...（提供済み）
  - エンドポイント: https://api.line.me/v2/bot/message/push

### 7.5 ホスティング
- **GitHub Pages**: 静的サイトホスティング（HTTPS必須、PWA要件）

### 7.6 バージョン管理
- **Git/GitHub**: ソースコード管理

## 8. ファイル構成

```
attendance-app/
├── index.html              # メインHTML
├── style.css               # スタイルシート
├── main.js                 # メインロジック
├── sw.js                   # Service Worker
├── manifest.json           # PWAマニフェスト
├── icons/
│   ├── icon-192x192.png   # アプリアイコン（小）
│   └── icon-512x512.png   # アプリアイコン（大）
├── 仕様書.md               # 本仕様書
├── prompts.txt             # AI対話記録
├── README.md               # プロジェクト説明
└── gas/
    ├── Code.gs             # Google Apps Script
    └── README.md           # GASセットアップガイド
```

## 9. API仕様

### 9.1 GAS Web App エンドポイント

**URL**: デプロイ後に取得
**メソッド**: POST

#### 9.1.1 出勤打刻API

**リクエスト**:
```json
{
  "action": "clock_in",
  "userId": "user01",
  "name": "konaka33",
  "timestamp": "2025/10/30 09:05"
}
```

**レスポンス**:
```json
{
  "status": "success",
  "message": "出勤を記録しました",
  "data": {
    "date": "2025/10/30",
    "clockIn": "09:05"
  }
}
```

#### 9.1.2 退勤打刻API

**リクエスト**:
```json
{
  "action": "clock_out",
  "userId": "user01",
  "name": "konaka33",
  "timestamp": "2025/10/30 18:10"
}
```

**レスポンス**:
```json
{
  "status": "success",
  "message": "退勤を記録しました",
  "data": {
    "date": "2025/10/30",
    "clockIn": "09:05",
    "clockOut": "18:10",
    "workingHours": "9時間5分"
  }
}
```

#### 9.1.3 本日の記録取得API

**リクエスト**:
```json
{
  "action": "get_today",
  "userId": "user01",
  "date": "2025/10/30"
}
```

**レスポンス**:
```json
{
  "status": "success",
  "data": {
    "date": "2025/10/30",
    "clockIn": "09:05",
    "clockOut": "18:10",
    "workingHours": "9時間5分"
  }
}
```

#### 9.1.4 課題完了報告API

**リクエスト**:
```json
{
  "action": "complete_task",
  "userId": "user01",
  "name": "konaka33",
  "appUrl": "https://konaka33.github.io/attendance-app",
  "timestamp": "2025/10/30 15:30"
}
```

**レスポンス**:
```json
{
  "status": "success",
  "message": "課題完了を報告しました"
}
```

### 9.2 LINE Messaging API

**エンドポイント**: https://api.line.me/v2/bot/message/push
**メソッド**: POST
**ヘッダー**:
```
Authorization: Bearer YOZ7Uft...（アクセストークン）
Content-Type: application/json
```

**リクエストボディ**:
```json
{
  "to": "C5a5b36e27a78ed6cfbb74839a8a9d04e",
  "messages": [
    {
      "type": "text",
      "text": "【出勤】\nkonaka33 (user01)\n2025/10/30 09:05"
    }
  ]
}
```

## 10. 非機能要件

### 10.1 対応デバイス
- **スマートフォン**: iOS Safari, Android Chrome（主要）
- **PC**: Chrome, Firefox, Safari, Edge（補助）

### 10.2 PWA要件
- HTTPS接続必須（GitHub Pages標準対応）
- Service Worker登録
- manifest.json設置
- 192x192, 512x512 アイコン
- インストール可能

### 10.3 パフォーマンス
- 初回ロード: 3秒以内
- 打刻ボタン応答: 1秒以内（UI反応）
- API通信: 5秒以内（タイムアウト設定）

### 10.4 エラーハンドリング
- ネットワークエラー: リトライ案内表示
- API エラー: エラーメッセージ表示
- 二重打刻防止: 出勤済みの場合は出勤ボタン無効化

## 11. 合格基準

### 11.1 必須項目（すべて動作）
- [ ] 出勤ボタンでLINE通知が届く
- [ ] 退勤ボタンで勤務時間が計算される
- [ ] スプレッドシートに正しく記録される
- [ ] 課題完了ボタンで管理者に通知が届く
- [ ] PWAとしてスマホにインストールできる

### 11.2 加点ポイント
- [ ] デザインが見やすく、使いやすい
  - [ ] 現在時刻のリアルタイム表示（1秒ごと更新）
  - [ ] ボタン押下時のアニメーション（scale, ripple effect）
  - [ ] ダークモード対応（@media prefers-color-scheme）
- [ ] エラーハンドリングが適切
  - [ ] エラーメッセージの日本語化（技術用語を平易に）
  - [ ] 二重打刻防止（バリデーション）
  - [ ] リトライ機能（ネットワークエラー時、最大3回）
  - [ ] ローディング表示（ボタン無効化＋スピナー）
- [ ] コードにコメントがあり、可読性が高い
  - [ ] JSDocで全関数に説明
  - [ ] 定数の一元管理（CONFIG オブジェクト）
- [ ] README に丁寧なセットアップ手順
- [ ] 本日の記録がリアルタイム表示される

## 12. 開発スケジュール（想定）

| フェーズ | 作業内容 | 所要時間 |
|---------|---------|---------|
| Phase 1 | 仕様書作成・レビュー | 1時間 |
| Phase 2 | HTML/CSS実装（PWA基本構造） | 1.5時間 |
| Phase 3 | JavaScript実装（打刻機能） | 2時間 |
| Phase 4 | GAS実装（スプレッドシート＋LINE連携） | 2時間 |
| Phase 5 | PWA実装（manifest, Service Worker） | 1時間 |
| Phase 6 | テスト・デバッグ | 1時間 |
| Phase 7 | GitHub Pages公開・動作確認 | 0.5時間 |

## 13. セキュリティ考慮事項

### 13.1 認証
- 本アプリは簡易版のため、研修生IDをlocalStorageに保存
- 実運用では認証機能の追加を推奨

### 13.2 APIキー管理
- LINE アクセストークンはGAS内に記載（クライアント側に露出しない）
- GAS Web App URLのみフロントエンドに記載

### 13.3 データ保護
- HTTPS通信（GitHub Pages標準）
- スプレッドシートは編集権限を管理者のみに制限

## 14. テスト項目

### 14.1 機能テスト
- [ ] 出勤打刻が正常に動作
- [ ] 退勤打刻が正常に動作
- [ ] 勤務時間が正しく計算される
- [ ] LINE通知が正しく送信される
- [ ] スプレッドシートに記録される
- [ ] 課題完了報告が送信される

### 14.2 PWAテスト
- [ ] manifest.json が正しく認識される
- [ ] Service Worker が登録される
- [ ] ホーム画面に追加できる
- [ ] アイコンが正しく表示される
- [ ] オフライン時も起動する

### 14.3 UIテスト
- [ ] スマホで見やすい
- [ ] ボタンがタップしやすい
- [ ] 現在時刻が表示される
- [ ] 本日の記録が表示される

### 14.4 エラーテスト
- [ ] ネットワークエラー時の動作
- [ ] 二重打刻の防止
- [ ] API エラー時のメッセージ表示

## 15. 備考

### 15.1 今後の拡張案
- 認証機能（Googleログイン等）
- 打刻履歴一覧表示
- 月別集計機能
- 位置情報記録（GPS）
- 顔認証機能

### 15.2 既知の制限事項
- 研修生IDはlocalStorageに保存（簡易版）
- オフライン時は打刻不可（通信必須）
- 同日中の複数回打刻は最後のみ有効

### 15.3 参考リンク
- [LINE Messaging API ドキュメント](https://developers.line.biz/ja/docs/messaging-api/)
- [Google Apps Script ドキュメント](https://developers.google.com/apps-script)
- [PWA 実装ガイド](https://web.dev/progressive-web-apps/)
- [Service Worker API](https://developer.mozilla.org/ja/docs/Web/API/Service_Worker_API)
